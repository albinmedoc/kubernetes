apiVersion: monitoring.coreos.com/v1
kind: Prometheus
metadata:
  name: prometheus
  namespace: default
  labels:
    app: prometheus
spec:
  serviceAccountName: prometheus
  replicas: 1
  retention: 30d
  retentionSize: "50GB"

  # Resource requests and limits
  resources:
    requests:
      memory: 2Gi
      cpu: 500m
    limits:
      memory: 4Gi
      cpu: 2000m

  # Storage configuration - adjust based on your storage class
  storage:
    volumeClaimTemplate:
      spec:
        storageClassName: truenas-iscsi
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 100Gi

  # Enable service monitor discovery
  serviceMonitorSelector:
    matchLabels:
      prometheus: "true"

  # Namespace discovery for ServiceMonitors
  serviceMonitorNamespaceSelector: {}

  # Enable pod monitor discovery
  podMonitorSelector:
    matchLabels:
      prometheus: "true"

  podMonitorNamespaceSelector: {}

  # Rule selector for PrometheusRules
  ruleSelector:
    matchLabels:
      prometheus: "true"

  ruleNamespaceSelector: {}

  # Enable admin API for management
  enableAdminAPI: false

  # Security context
  securityContext:
    fsGroup: 2000
    runAsNonRoot: true
    runAsUser: 1000
